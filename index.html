<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CWT 2025 - アクセシブルなウェブデザインとは何か</title>
    <meta name="description" content="ウェブアクセシビリティに関するセミナープレゼンテーション。障害のある人を含むすべてのユーザーが利用しやすいウェブサイトの作り方を学びます。">

    <!-- Tailwind CSS -->
    <link rel="stylesheet" href="dist/output.css">

    <!-- Syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
</head>
<body>
    <!-- Skip to content link -->
    <a href="#main-content" class="skip-link">メインコンテンツへスキップ</a>

    <!-- Slide progress indicator -->
    <nav aria-label="スライド進行状況" class="slide-progress">
        <div id="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
    </nav>

    <main id="main-content" class="presentation-container" role="main">
        <!-- Slides will be dynamically loaded here -->
    </main>

    <!-- Markdown parser -->
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>
    <!-- Syntax highlighting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <script>
        // Configure marked for accessibility
        marked.setOptions({
            breaks: true,
            gfm: true
        });

        // Load and parse markdown
        async function loadSlides() {
            try {
                const response = await fetch('slides.md');
                const markdown = await response.text();

                // Split by horizontal separator (---)
                const slides = markdown.split(/\r?\n---\r?\n/).filter(s => s.trim());

                const container = document.querySelector('.presentation-container');

                slides.forEach((slideContent, index) => {
                    const section = document.createElement('section');
                    section.className = 'slide';
                    section.id = `slide-${index + 1}`;
                    section.setAttribute('aria-label', `スライド ${index + 1} / ${slides.length}`);

                    // Parse markdown to HTML
                    const html = marked.parse(slideContent.trim());

                    const contentDiv = document.createElement('div');
                    contentDiv.className = 'slide-content';
                    contentDiv.innerHTML = html;

                    section.appendChild(contentDiv);
                    container.appendChild(section);
                });

                // Apply syntax highlighting
                document.querySelectorAll('pre code').forEach((block) => {
                    hljs.highlightElement(block);
                });

                // Setup scroll progress
                setupScrollProgress(slides.length);

                // Setup intersection observer for slide announcements
                setupSlideObserver();

            } catch (error) {
                console.error('Failed to load slides:', error);
                document.querySelector('.presentation-container').innerHTML =
                    '<div class="error">スライドの読み込みに失敗しました。</div>';
            }
        }

        // Setup scroll progress indicator
        function setupScrollProgress(totalSlides) {
            const progressBar = document.getElementById('progress-bar');

            window.addEventListener('scroll', () => {
                const windowHeight = window.innerHeight;
                const documentHeight = document.documentElement.scrollHeight - windowHeight;
                const scrolled = window.scrollY;
                const progress = (scrolled / documentHeight) * 100;

                progressBar.style.width = `${progress}%`;
                progressBar.setAttribute('aria-valuenow', Math.round(progress));
            });
        }

        // Announce slide changes to screen readers
        function setupSlideObserver() {
            // Create live region for announcements
            const liveRegion = document.createElement('div');
            liveRegion.id = 'slide-announcement';
            liveRegion.setAttribute('aria-live', 'polite');
            liveRegion.setAttribute('aria-atomic', 'true');
            liveRegion.className = 'sr-only';
            document.body.appendChild(liveRegion);

            const options = {
                root: null,
                rootMargin: '0px',
                threshold: 0.5
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const slideLabel = entry.target.getAttribute('aria-label');
                        const firstHeading = entry.target.querySelector('h1, h2, h3');
                        const headingText = firstHeading ? firstHeading.textContent : '';
                        liveRegion.textContent = `${slideLabel}。${headingText}`;
                    }
                });
            }, options);

            // Observe all slides after a short delay to ensure they're loaded
            setTimeout(() => {
                document.querySelectorAll('.slide').forEach(slide => {
                    observer.observe(slide);
                });
            }, 100);
        }

        // Load slides on page load
        document.addEventListener('DOMContentLoaded', loadSlides);
    </script>
</body>
</html>
